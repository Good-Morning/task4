<!DOCTYPE html>

<html>
    <head>
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width,initial-scale=1">

        <link rel="stylesheet" href="styles/styles.css"             charset="utf-8">
        
        <link rel="stylesheet" href="styles/header.css"             charset="utf-8">
        <link rel="stylesheet" href="styles/logo.css"               charset="utf-8">
        <link rel="stylesheet" href="styles/search.css"             charset="utf-8">
        <link rel="stylesheet" href="styles/menu.css"               charset="utf-8">
        
        <link rel="stylesheet" href="styles/main-page.css"          charset="utf-8">
        
        <link rel="stylesheet" href="styles/mails-maintainance.css" charset="utf-8">
        <link rel="stylesheet" href="styles/mails-header.css"       charset="utf-8">
        <link rel="stylesheet" href="styles/mails-menu.css"         charset="utf-8">
        <link rel="stylesheet" href="styles/mails-footer.css"       charset="utf-8">
        <link rel="stylesheet" href="styles/mail.css"               charset="utf-8">

        <link rel="stylesheet" href="styles/mail-title.css"         charset="utf-8">
        <link rel="stylesheet" href="styles/mail-article.css"       charset="utf-8">


        <link rel="stylesheet" href="styles/specific/article0.css"  charset="utf-8">
        <link rel="stylesheet" href="styles/specific/article1.css"  charset="utf-8">
        
        <link rel="icon" href="resources/favicon.png">

        <title>Яндекс.ВидимостьПочты</title>
    </head>

    <body id="background">
        <div class="background__content">
            <header class="header">
                <div class="logo">
                    <div class="logo__burger">
                        <div class="logo__burger-1"></div>
                    </div>
                    <img class="logo__title" alt="логотип" src="resources/logo.png" width="153" height="31">
                </div>
                <div class="search">
                    <input type="text" class="search__field" value="Поиск">
                </div>
            </header>
            <div class="main-page">
                <div class="main-page__menu-wrapper">
                    <ul class="menu">
                        <li class="menu__write-mail" id="write-mail">Написать
                        <li class="menu__item">Входящие
                        <li class="menu__item">Отправленные
                        <li class="menu__item">Удаленные
                        <li class="menu__item">Спам
                        <li class="menu__item">Черновики
                        <li class="menu__item">Создать папку
                    </ul>
                </div>
                <div class="main-page__mails-maintainance-wrapper">
                    <div class="mails-maintainance">
                        <div class="mails-header">
                            <input type="checkbox" class="mails-header__checkbox" id="select-all">
                            <div class="mails-header__mails-menu-wrapper">
                                <ul class="mails-menu">
                                    <li class="mails-menu__item-wrapper"><input class="mails-menu__item" id="forward-button" type="button" value="Переслать">
                                    <li class="mails-menu__item-wrapper"><input class="mails-menu__item" id="delete-button"  type="button" value="Удалить">
                                    <li class="mails-menu__item-wrapper"><input class="mails-menu__item" id="smap-button"    type="button" value="Это бан!">
                                    <li class="mails-menu__item-wrapper"><input class="mails-menu__item" id="read-button"    type="button" value="Прочитано">
                                </ul>
                            </div>
                        </div>
                        <template id="new-mail">
                            <div class="mail">
                                <input class="mail__checkbox" id="mail-trigger${mailID}" type="checkbox">
                                <div class="mail-title mail-title_unread mail-title_from-delete">
                                    <input type="checkbox" class="mail-title__checkbox">
                                    <div class="mail-title__img-wrapper">
                                    </div>
                                    <div class="mail-title__sender">${sender}</div>
                                    <div class="mail-title__unread-flag"></div>
                                    <label class="mail-title__title" for="mail-trigger${mailID}">${title}</label>
                                    <time class="mail-title__date">${getDate()}</time>
                                </div>
                                <article class="mail-article">
                                    <label class="mail-article__cross" for="mail-trigger${mailID}">
                                        <img src="resources/mail_cross.png" alt="quiting cross" width="18px" height="18px">
                                    </label>
                                    <div class="article1">
                                        <div></div>
                                        <footer class="article1__footer"><a href="http://numbersapi.com" target="_blank">NUMBERSAPI</a></footer>
                                    </div>
                                    <footer class="mail-article__clearfix"></footer>
                                </article>
                            </div>
                        </template>
                        <div class="mail">
                            <input class="mail__checkbox" id="mail-trigger0" type="checkbox">
                            <div class="mail-title mail-title_unread">
                                <input type="checkbox" class="mail-title__checkbox">
                                <div class="mail-title__img-wrapper">
                                    <img src="resources/avatar.png" width="30px" height="30px">
                                </div>
                                <div   class="mail-title__sender">Яндекс.Паспорт</div>
                                <div   class="mail-title__unread-flag"></div>
                                <label class="mail-title__title" for="mail-trigger0">Доступ к аккаунту восстановлен</label>
                                <time  class="mail-title__date">6 авг</time>
                            </div>
                            <article class="mail-article">
                                <label class="mail-article__cross" for="mail-trigger0">
                                    <img src="resources/mail_cross.png" alt="quiting cross" width="18px" height="18px">
                                </label>
                                <div class="article0">
                                    <img src="resources/button.png" class="article0__float-img" alt="Пуговица" width="200px" height="200px">
                                    <p class="article0__p0">
                                        Здравствуйте, девочки, здравствуйте, мальчики, <br>
                                        Смотрите на меня в окно и мне кидайте свои пальчики, да-а <br>
                                    </p>
                                    <p class="article0__p0"> 
                                        Ведь я сажаю алюминиевые огурцы, а-а на брезентовом поле <br>
                                        Я сажаю алюминиевые огурцы, а-а на брезентовом поле. <br>
                                    </p>
                                    <p class="article0__p0"> 
                                        Три чукотских мудреца твердят, твердят мне без конца: <br>
                                        "Металл не принесёт плода, игра не стоит свеч, а результат - труда", <br>
                                    </p>
                                    <p class="article0__p0"> 
                                        Но я сажаю алюминиевые огурцы, а-а На брезентовом поле <br>
                                        Я сажаю алюминиевые огурцы, а-а на брезентовом поле. <br>
                                    </p>
                                    <p class="article0__p0"> 
                                        Злое белое колено пытается меня достать, <br>
                                        Колом колено колет вены в надежде тайну разгадать, <br>
                                    </p>
                                    <p class="article0__p0"> 
                                        Зачем я сажаю алюминиевые огурцы, а-а на брезентовом поле <br>
                                        Я сажаю алюминиевые огурцы, а-а на брезентовом поле. <br>
                                    </p>
                                    <p class="article0__p0"> 
                                        Кнопки, скрепки, клёпки, дырки, булки, вилки, <br>
                                        Здесь тракторы пройдут мои и упадут в копилку, упадут туда, <br>
                                    </p>
                                    <p class="article0__p0"> 
                                        Где я сажаю алюминиевые огурцы, а-а на брезентовом поле <br>
                                        Я сажаю алюминиевые огурцы, а-а на брезентовом поле <br> 
                                        Я сажаю алюминиевые огурцы, а-а на брезентовом поле <br>
                                        Я сажаю алюминиевые огурцы, а-а на брезентовом поле. <br>
                                    </p>
                                    <footer class="article0__footer">Алюминевые огурцы - В.Цой</footer>
                                </div> 
                                <footer class="mail-article__clearfix"></footer>
                            </article>
                        </div>
                        <div class="mail">
                            <input class="mail__checkbox" id="mail-trigger1" type="checkbox">
                            <div class="mail-title mail-title_unread">
                                <input type="checkbox" class="mail-title__checkbox">
                                <div class="mail-title__img-wrapper">
                                    <img src="resources/avatar.png" width="30px" height="30px">
                                </div>
                                <div   class="mail-title__sender">Команда Яндекс.Почты</div>
                                <div   class="mail-title__unread-flag"></div>
                                <label class="mail-title__title" for="mail-trigger1">Как читать почту с мобильного</label>
                                <time  class="mail-title__date">6 июл</time>
                            </div>
                            <article class="mail-article">
                                <label class="mail-article__cross" for="mail-trigger1">
                                    <img src="resources/mail_cross.png" alt="quiting cross" width="18px" height="18px">
                                </label>
                                Ниже - письма из прошлых дз. Они не открываются. Это фича. 
                                (Не, правда - сделать их открываемыми проще, чем обрабатывать неоткрываемые.)
                                <footer class="mail-article__clearfix"></footer>
                            </article>
                        </div>
                        <div class="mail">
                            <div class="mail-title mail-title_read">
                                <input type="checkbox" class="mail-title__checkbox">
                                <div class="mail-title__img-wrapper">
                                    <img src="resources/avatar.png" width="30px" height="30px">
                                </div>
                                <div  class="mail-title__sender">Команда Яндекс.Почты</div>
                                <div  class="mail-title__unread-flag"></div>
                                <div  class="mail-title__title">Как читать почту с мобильного</div>
                                <time class="mail-title__date">6 июл</time>
                            </div>
                        </div>
                        <div class="mail">
                            <div class="mail-title mail-title_read">
                                <input type="checkbox" class="mail-title__checkbox">
                                <div class="mail-title__img-wrapper">
                                    <img src="resources/avatar.png" width="30px" height="30px">
                                </div>
                                <div  class="mail-title__sender">Яндекс</div>
                                <div  class="mail-title__unread-flag"></div>
                                <div  class="mail-title__title">Соберите всю почту в этот ящик</div>
                                <time class="mail-title__date">6 июл</time>
                            </div>
                        </div>
                        <div class="mails-maintainance__pillar"></div>
                        <div class="mails-maintainance__mails-footer-wrapper">
                            <footer class="mails-footer">
                                <div class="mails-footer__element">Помощь и обратная связь</div>
                                <div class="mails-footer__element">Реклама</div>
                                <div class="mails-footer__element" title="права на оригинальный макет">© 2001—2018, Яндекс</div>
                            </footer>  
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <script lang="javascript">
            
            function getLetter(mail) {
                return Array.from(mail.children)
                    .map(m => m.classList.contains("mail-title") ? m : null)
                    .reduce((n, m) => n || m)
            }

            var getCheckBox = mail => getLetter(mail).children[0]

            var elementsOfClass = className => Array.from(document.getElementsByClassName(className))

            mails = new Set(elementsOfClass("mail"))

            var month = ['янв.', 'фев.', 'март.', 'апр.', 'май.', 'июн.', 'июл.', 'авг.', 'сен.', 'окт.', 'ноя.', 'дек.']
            function getDate() {
                var temp = new Date()
                return temp.getDate() + ' ' + month[temp.getMonth()]                
            }

            var mailMaintainances = elementsOfClass("mails-maintainance")
            var mailCounter = 2
            function constructMailOnPage(sender, title, body) {
                var mailID = mailCounter++

                res = document.getElementById("new-mail").content.children[0].cloneNode(true)
                res.querySelector(".mail__checkbox").id=`mail-trigger${mailID}`
                res.querySelector(".mail-title__title").setAttribute("for", `mail-trigger${mailID}`)
                res.querySelector(".mail-article__cross").setAttribute("for", `mail-trigger${mailID}`)
                res.querySelector(".mail-title__sender").innerHTML = sender
                res.querySelector(".mail-title__title").innerHTML = title
                res.querySelector(".mail-title__date").innerHTML = getDate()
                res.querySelector(".article1").children[0].innerHTML = body
                
                mailMaintainances.forEach(m => m.insertBefore(res, m.children[2]))
                var mail = getLetter(res)
                setTimeout(() => {
                    mail.classList.add("mail-title_to-appear")
                }, 100)
                setTimeout(() => { 
                    mail.classList.remove("mail-title_from-delete", "mail-title_to-appear")
                }, 300)
                mails.add(res)
            }

            document.getElementById("delete-button").addEventListener("click", () => {
                Array.from(mails)
                    .filter(mail => getCheckBox(mail).checked)
                    .forEach(mail => { 
                        mails.delete(mail)
                        getLetter(mail).classList.add("mail-title_to-delete")
                        setTimeout(() => mail.parentElement.removeChild(mail), 200)
                    })
            })

            var selectAllCheckBox = document.getElementById("select-all")
            selectAllCheckBox.addEventListener("click", () => 
                mails.forEach(mail => getCheckBox(mail).checked = selectAllCheckBox.checked))

            var requestsCounter = 0
            function addMail() {
                if (mails.size < 30) {
                    var xhr = new XMLHttpRequest()
                    xhr.open('GET', `http://numbersapi.com/${requestsCounter}`, true)
                    xhr.send()
                    xhr.onreadystatechange = function() {
                        if (xhr.readyState != xhr.DONE) {return} 
                        if (xhr.status != 200) {
                            constructMailOnPage("mysterious stranger", "Что говорить, когда нечего говорить?", "Нет соединения. Inception - ЧБУ YouTube")
                        } else {
                            constructMailOnPage("mysterious stranger", `Did ya know?.. About ${requestsCounter}`, xhr.responseText)
                            requestsCounter++
                        }
                    }
                }
            }

            function newMailTimeoutSetup() {
                setTimeout(() => {
                    addMail()
                    newMailTimeoutSetup()
                }, (Math.random() + 1) * 5*60*1000)
            }
            newMailTimeoutSetup()

            document.getElementById("write-mail").addEventListener("click", addMail)
            
        </script>
    </body>
</html>
